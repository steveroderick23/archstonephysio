var story_search="story";var archive_search="archive";var story_page="story";var archive_page="archiveBrowse";var search_action="search";var archive_search_landing_action="searchLanding";var active_search_link="active-search-link";var start_type="start";var end_type="end";var date_format="format";var date_error="error";var $=jQuery;$(document).ready(function(){$(".site-search").on("click",function(){$("header .search").find(".tooltip").hide();$("header .search").removeClass("active")});var a=window.storage.getItem(active_search_link);if(a){jQuery("."+a+"-search-bar-icon").addClass("active")}setDateRangeFilter(getURLParameterValue("dateRange"));setSort(getURLParameterValue("sort"));initDatePickers();checkPublications();activateSearchField(getURLParameterValue("q"));$("#search-input").change(function(){activateSearchField($(this).val().length!==0)}).keyup(function(){$(this).change()});$(".start").on("change",function(){validate()});$(".end").on("change",function(){validate()});$(".site-search").on("submit",function(b){if(!validate()){b.preventDefault()}});$(".viewer-url").on("click",function(){var b=$(this).data("url");var c=$(this).data("mobile");if(isMobile.any()){$(this).attr("target","");$(this).attr("href",c)}else{$(this).attr("target","");$(this).attr("href",b)}});$(".pub-dropdown dt a").on("click",function(){$(".pub-dropdown dd ul").slideToggle("fast");$("body").addClass("publication-selection-opened")});$(".dropdown dd ul li a").on("click",function(){$(".dropdown dd ul").hide()});$(".boxclose").on("click",function(){$(".mutliSelect ul").hide();$("body").removeClass("publication-selection-opened")});$(".search-filters li").on("click",function(){deactivateFilters();setDateRangeFilter($(this).attr("class"))});$(".publication-select-item").on("click",function(){var b=$(this);if(b.hasClass("all")){toggleAllPublications(b)}else{togglePublication(b)}});$(document).bind("click",function(c){var b=$(c.target);if(!b.parents().hasClass("pub-dropdown")){$(".pub-dropdown dd ul").hide();$("body").removeClass("publication-selection-opened")}});jQuery("#search-stories-link").on("click",function(b){jQuery(this).addClass("active");jQuery(this).find(".story-search-bar-icon").addClass("active");jQuery("#search-archives-link").find(".archive-search-bar-icon").removeClass("active");jQuery("#search-archives-link").removeClass("active");window.storage.setItem(active_search_link,story_search);if(window.currentAction===search_action&&window.currentPage==archive_page||window.currentAction==archive_search_landing_action){var c=getQueryParameters();window.location="/story/search?"+c+"&previous="+archive_search}else{if(window.currentAction!==search_action&&window.currentAction!==archive_search_landing_action){jQuery("#search-bar").slideToggle(15);setTimeout(function(){jQuery("header .search").find(".tooltip").hide();jQuery("header .search").removeClass("active")},0)}}});jQuery("#search-archives-link").on("click",function(b){jQuery(this).addClass("active");jQuery(this).find(".archive-search-bar-icon").addClass("active");jQuery("#search-stories-link").find(".story-search-bar-icon").removeClass("active");jQuery("#search-stories-link").removeClass("active");window.storage.setItem(active_search_link,archive_search);if(window.currentAction===search_action&&window.currentPage===story_page){var c=getQueryParameters();window.location="/archiveBrowse/search?"+c+"&previous="+story_search}else{if(window.currentAction!==search_action&&window.currentAction!==archive_search_landing_action){window.location="/archiveBrowse/searchLanding"}}})});function getQueryParameters(){var a=getURLParameterValue("q")||"";var b={q:a,page:1,sources:null};return $.param(b)}function toggleAllPublications(a){if(a.hasClass("active")){a.removeClass("active");$(".publication-select-item").removeClass("active");$(".publication-select-item .publication-select-button").removeClass("active");$(".publication-select-item .publication-select-checkbox").prop("checked",false)}else{a.addClass("active");$(".publication-select-item").addClass("active");$(".publication-select-item .publication-select-button").addClass("active");$(".publication-select-item .publication-select-checkbox").prop("checked",true)}}function togglePublication(c){var b=c.find("[type=button]");var a=c.find("[type=checkbox]");if(c.hasClass("active")){c.removeClass("active");b.removeClass("active");a.prop("checked",false)}else{c.addClass("active");b.addClass("active");a.prop("checked",true)}}function checkPublications(){var b=$(".publication-filter li").not(".all");var a=true;$.each(b,function(){if(!$(this).hasClass("active")){a=false;return}});if(a){$(".publication-select-item.all").addClass("active");$(".publication-select-button.all").addClass("active")}}function getURLParameterValue(d,c){url=window.location.search;var b=url.indexOf(d);if(b===-1){return false}else{var a=url.substr(b,url.length);value=a.split("=")[1];if(!value){return false}value=value.split("&")[0];value=value.split("#")[0];value=value.replace(/[+]/g," ");return decodeURIComponent(value)}}function setDateRangeFilter(b){var a={"7days":setWeekly,"30days":setMonthly,custom:setCustom,all:setAll};if(b&&typeof b!=="undefined"){a[b]()}else{a[$("#dateRange").val()]()}}function setSort(a){$("#"+a).attr("selected","selected")}function setWeekly(){var a=$(".search-filters .7days");a.addClass("active");setDatePickers(true);setDateRangeFromValue(a.attr("data-value"))}function setMonthly(){var a=$(".search-filters .30days");a.addClass("active");setDatePickers(true);setDateRangeFromValue(a.attr("data-value"))}function setCustom(){var a=$(".search-filters .custom");a.addClass("active");showDateRange();setDateRangeFromValue(a.attr("data-value"))}function setAll(){var a=$(".search-filters .all");a.addClass("active");setDatePickers(true);setDateRangeFromValue(a.attr("data-value"))}function showDateRange(){$(".date-range-form").show();$("#search-bar").addClass("dates")}function hideDateRange(){$(".date-range-form").hide();$("#search-bar").removeClass("dates")}function deactivateFilters(){$(".search-filters li").removeClass("active");hideDateRange()}function setDateRangeFromValue(a){$("#dateRange").val(a)}function setDatePickers(c){var b=$(".end");var e=$(".start");var d=new Date();var a=new Date("1/1/1900");if(getURLParameterValue("end")&&!c){d=new Date(getURLParameterValue("end"))}if(getURLParameterValue("start")&&!c){a=new Date(getURLParameterValue("start"))}b.datepicker("setDate",d);e.datepicker("setDate",a);e.datepicker("option","maxDate",b.datepicker("getDate"));b.datepicker("option","minDate",e.datepicker("getDate"))}function initDatePickers(){var a=$(".end");var b=$(".start");if(window.language==="en"){$.datepicker.setDefaults($.datepicker.regional[""])}else{$.datepicker.regional.fr={clearText:"Effacer",clearStatus:"",closeText:"Fermer",closeStatus:"Fermer sans modifier",prevText:"&lt;Préc",prevStatus:"Voir le mois précédent",nextText:"Suiv&gt;",nextStatus:"Voir le mois suivant",currentText:"Courant",currentStatus:"Voir le mois courant",monthNames:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],monthNamesShort:["Jan","Fév","Mar","Avr","Mai","Jun","Jul","Aoû","Sep","Oct","Nov","Déc"],monthStatus:"Voir un autre mois",yearStatus:"Voir un autre année",weekHeader:"Sm",weekStatus:"",dayNames:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],dayNamesShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],dayNamesMin:["Di","Lu","Ma","Me","Je","Ve","Sa"],dayStatus:"Utiliser DD comme premier jour de la semaine",dateStatus:"Choisir le DD, MM d",dateFormat:"dd/mm/yy",firstDay:0,initStatus:"Choisir la date",isRTL:false};$.datepicker.setDefaults($.datepicker.regional.fr)}$.datepicker.setDefaults({showOn:"button",buttonImage:"/img/calendar_icon.png",buttonImageOnly:true,buttonText:"Select date",dateFormat:"mm/dd/yy",changeMonth:true,changeYear:true,yearRange:"1800:"+new Date().getFullYear(),onChangeMonthYear:function(d,e,c){$(this).datepicker("setDate",new Date(d,e-1,c.selectedDay))}});b.datepicker({maxDate:new Date(),fixFocusIE:false,onSelect:function(){a.datepicker("option","minDate",$(this).datepicker("getDate"));this.fixFocusIE=true;$(this).blur().change().focus()},onClose:function(){a.datepicker("option","minDate",$(this).datepicker("getDate"));this.fixFocusIE=true;$(this).blur()},beforeShow:function(){var c=($.browser.msie||!!navigator.userAgent.match(/Trident\/7\./))?!this.fixFocusIE:true;this.fixFocusIE=false;return c},onChange:function(){a.datepicker("option","minDate",$(this).datepicker("getDate"))}});a.datepicker({maxDate:new Date(),fixFocusIE:false,onSelect:function(){$(this).datepicker("option","minDate",b.datepicker("getDate"));b.datepicker("option","maxDate",$(this).datepicker("getDate"));this.fixFocusIE=true;$(this).blur().change().focus()},onClose:function(){b.datepicker("option","maxDate",$(this).datepicker("getDate"));this.fixFocusIE=true;$(this).blur()},beforeShow:function(){var c=($.browser.msie||!!navigator.userAgent.match(/Trident\/7\./))?!this.fixFocusIE:true;this.fixFocusIE=false;return c},onChange:function(){b.datepicker("option","maxDate",$(this).datepicker("getDate"))}});setDatePickers()}function activateSearchField(b){var a=$(".go");if(b){a.addClass("active")}else{a.removeClass("active")}}function validate(){var c=new Date();c.setHours(0,0,0,0);var g=$(".start");var a=new Date(g.val());var b=$(".end");var f=new Date(b.val());var e=$(".error-message");var d=/^((0?[1-9]|1[012])[- /.](0?[1-9]|[12][0-9]|3[01])[- /.](18|19|20)?[0-9]{2})*$/;if(!d.test(g.val())){clearErrors(g,b,e);setError(g,e,start_type,true);return false}else{if(!d.test(b.val())){clearErrors(g,b,e);setError(b,e,end_type,true);return false}else{if(a>c){clearErrors(g,b,e);setError(g,e,start_type);return false}else{if(f>c){clearErrors(g,b,e);setError(b,e,end_type);return false}else{if(a>f){clearErrors(g,b,e);setError(g,e,start_type);return false}else{clearErrors(g,b,e);return true}}}}}}function setError(a,d,c,f){var b=date_error;if(f){b=date_format}var e=a.attr("data-msg-"+b);d.text(e);a.addClass("search-input-error");d.addClass("error-"+c);a.select();a.focus()}function clearErrors(c,a,b){b.text("");c.removeClass("search-input-error");a.removeClass("search-input-error");b.removeClass("error-start");b.removeClass("error-end")}$(window).on("load",function(b){if(window.currentAction==archive_search_landing_action){var a=$("#search-bar");a.eq(0).remove()}});