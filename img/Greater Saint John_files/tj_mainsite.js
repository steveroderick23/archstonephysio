jQuery(document).on("ready",function(){jQuery(".eedition-image").on("click",function(){var a=jQuery(this).find("a").attr("href");trackLogForOliveViewer(a)});jQuery(".obits-redirect").on("click",function(){var a=jQuery(this).find("a").attr("href");trackLogForObituaries(a)});if(isIE(9,"lte")){jQuery("#embededLogo").hide();jQuery("#ieImage").css("visibility","visible");jQuery("#ieImage").show()}jQuery("form#usernameChangeForm #username-close").on("click",function(a){jQuery("#changeUsernameDialog").dialog("close")});jQuery("form#usernameChangeForm #username-confirm").on("click",function(a){changeUsername(jQuery("form#usernameChangeForm #newUsername").val(),jQuery("form#usernameChangeForm #usernamePassword").val())})});jQuery(window).on("load",function(){jQuery("#send-verification").click(function(a){jQuery.ajax({url:"/mainAjax/sendVerificationEmail",dataType:"json",type:"POST",complete:function(b){jQuery("#alerts-verification-close").click()}})});jQuery.validator.addMethod("ddMMyyyyDate",function(b,a){return this.optional(a)||Date.parseExact(b,"dd-MM-yyyy")},"Please enter a valid date in the format dd-MM-yyyy");jQuery.validator.addMethod("cdnPostal",function(b,a){return this.optional(a)||b.match(/[a-zA-Z][0-9][a-zA-Z](-| |)[0-9][a-zA-Z][0-9]/)},"Please specify a valid postal code.");jQuery("#e-edition-icon").on("click",function(){if(!window.ePaperGenerated){generateEPaper(jQuery(this).attr("pubid"))}});jQuery(".slider-toggle-override").on("click",function(){jQuery("#e-edition-icon").trigger("click");event.preventDefault()});jQuery("form#settingsForm").validate({onclick:false,onfocusout:false,rules:{cur_password:{required:true},new_password:{minlength:6,required:true},password2:{equalTo:"form#settingsForm #new_password",minlength:6,required:true}},messages:{cur_password:{required:TJ.t("required_field")},new_password:{required:TJ.t("required_field")},password2:{equalTo:TJ.t("passwords_must_match"),required:TJ.t("required_field")}}});jQuery("form#usernameChangeForm").validate({onkeyup:false,onclick:false,onfocusout:false,onfocusin:false,rules:{newUsername:{required:true,email:true},usernamePassword:{required:true}},messages:{newUsername:{required:TJ.t("required_field"),email:TJ.t("lbl_invalid_email")},usernamePassword:{required:TJ.t("required_field")}}});jQuery("form#settingsFormMobile").validate({onkeyup:false,onclick:false,onfocusout:false,rules:{mobile_cur_password:{required:true},mobile_password:{required:true},mobile_password2:{equalTo:"form#settingsFormMobile #mobile_password",required:true}},messages:{mobile_cur_password:{required:TJ.t("required_field")},mobile_password:{required:TJ.t("required_field")},mobile_password2:{equalTo:TJ.t("passwords_must_match"),required:TJ.t("required_field")}}});window.fbAsyncInit=function(){FB.init({appId:window.fbAppId,channelUrl:"/channel.html",status:true,cookie:true,xfbml:true})};(function(c){var b,e="facebook-jssdk",a=c.getElementsByTagName("script")[0];if(c.getElementById(e)){return}b=c.createElement("script");b.id=e;b.async=true;b.src="//connect.facebook.net/en_US/all.js";a.parentNode.insertBefore(b,a)}(document));jQuery(".facebook").click(function(a){fb_callout()})});function topStories(){jQuery("#top-stories .first .scale-image").each(function(){var h=jQuery(this).width();var g=jQuery(this).height();var b=jQuery(this).children("img");var f=jQuery(b).data("width");var e=jQuery(b).data("height");var d=g/e;var c=h/f;var i=f/e;var a=f*d;var j=e*c;if(i<1){if(h>a){b.css({width:h,height:"auto",top:-(j-g)/2,left:"auto"})}else{b.css({width:"auto",height:g,top:"auto",left:-(a-h)/2})}}else{if(h>a){b.css({width:h,height:"auto",top:-(j-g)/2,left:"auto"})}else{b.css({width:"auto",height:g,top:"auto",left:-(a-h)/2})}}jQuery(this).css("visibility","visible")})}function resizeLatestNews(){}function create_error_label(c,b){$("#"+c+"_error").remove();var a='<label class="error special" id = "'+c+'_error" style="display:block!important;">'+b+"</label>";if($("label[for="+c+"]").hasClass("error")&&$("label[for="+c+"]").html()!==""){}else{if($("#"+c+"_error").length<=0){$("#"+c).parent().append(a);$("#"+c+"_error").css("display","block");if(!$("#"+c+"_error").hasClass("special")){$("#"+c+"_error").addClass("special")}}else{$("#"+c+"_error").css("display","block");if(!$("#"+c+"_error").hasClass("special")){$("#"+c+"_error").addClass("special")}$("#"+c+"_error").html(b)}}$("#user_info").focus()}function setSubscriberReadNotifciation(a){}function savePassword(b,d,c){if(jQuery("#settingsForm").valid()){var a="/mainAjax/resetSubscriberPassword";jQuery.ajax({url:a,type:"POST",dataType:"json",data:{current_password:b,new_password:d},error:contactFormErrorMsg,success:function(e){if(e.status){contactFormSuccessMsg()}else{contactFormErrorMsg()}}})}}function changeUsernameDialog(){jQuery("form#usernameChangeForm #currentUsername").val(jQuery("form#settingsForm #user_email").val());dialog=jQuery("#changeUsernameDialog").dialog({resizable:false,modal:true,width:"auto",dialogClass:"changeUsernameForm",close:function(){jQuery("#usernameChangeForm")[0].reset();var a=jQuery("#usernameChangeForm").validate();a.resetForm()},draggable:false})}function changeUsername(b,a){if(jQuery("#usernameChangeForm").valid()){jQuery("#changeUsernameDialog .ajax-loader").show();jQuery("#changeUsernameDialog #username-confirm").hide();jQuery("#changeUsernameDialog #username-close").hide();jQuery.ajax({url:"/mainAjax/changeUsername",dataType:"json",type:"POST",data:{username:b,password:a},success:function(c){switch(c){case 0:insertLabelAfter("form#usernameChangeForm #usernamePassword",TJ.t("lbl_incorrect_password"),"error");jQuery("#changeUsernameDialog #username-confirm").show();jQuery("#changeUsernameDialog #username-close").show();break;case 1:insertLabelAfter("form#usernameChangeForm #newUsername",TJ.t("lbl_username_in_use"),"error");jQuery("#changeUsernameDialog #username-confirm").show();jQuery("#changeUsernameDialog #username-close").show();break;case 2:insertLabelAfter("form#usernameChangeForm #usernamePassword",TJ.t("lbl_sever_error").replace(":can_num",window.phoneHelpCA).replace(":us_num",window.phoneHelpUS),"error");jQuery("#changeUsernameDialog #username-confirm").show();jQuery("#changeUsernameDialog #username-close").show();break;case 3:jQuery("#changeUsernameDialog .change-success").show();jQuery("form#usernameChangeForm #newUsername").prop("disabled","disabled");jQuery("form#usernameChangeForm #usernamePassword").prop("disabled","disabled");break;case 4:insertLabelAfter("form#usernameChangeForm #usernamePassword",TJ.t("lbl_invalid_email"),"error");jQuery("#changeUsernameDialog #username-confirm").show();jQuery("#changeUsernameDialog #username-close").show();break;default:insertLabelAfter("form#usernameChangeForm #usernamePassword",TJ.t("lbl_sever_error").replace(":can_num",window.phoneHelpCA).replace(":us_num",window.phoneHelpUS),"error");jQuery("#changeUsernameDialog #username-confirm").show();jQuery("#changeUsernameDialog #username-close").show();break}},error:function(){insertLabelAfter("form#usernameChangeForm #usernamePassword",TJ.t("lbl_sever_error").replace(":can_num",window.phoneHelpCA).replace(":us_num",window.phoneHelpUS),"error");jQuery("#changeUsernameDialog #username-confirm").show();jQuery("#changeUsernameDialog #username-close").show()},complete:function(){jQuery("#changeUsernameDialog .ajax-loader").hide()}})}}function insertLabelAfter(d,c,a){var b=jQuery("<label>");b.html(c);b.addClass(a);b.attr("for",d);jQuery(b).insertAfter(d)}function clearFields(){jQuery(".clear-pass").val("")}function contactFormErrorMsg(){jQuery("input, select").removeClass("success");jQuery(".message").html(TJ.t("lbl_unsuccessful_update")).removeClass("success").addClass("error").fadeIn().delay(4000).fadeOut(500);clearFields()}function contactFormSuccessMsg(){jQuery("input, select").removeClass("error");jQuery(".message").html(TJ.t("lbl_successful_update")).removeClass("error").addClass("success").fadeIn().delay(4000).fadeOut(500);clearFields()}function generateEPaper(a){jQuery.ajax({url:"/mainAjax/buildEPaperSlider/",dataType:"html",type:"POST",data:{publicationId:a},success:function(b){jQuery("#epaper-placeholder").html(b);window.ePaperGenerated=true;jQuery("#todays-paper-slider").flexslider({animation:"slide",itemWidth:219,slideshow:false,controlNav:false,animationLoop:false});jQuery("#todays-paper-slider").width(jQuery(window).width()-112).css("margin-left",56);jQuery("#todays-paper-slider .flex-direction-nav").width(jQuery(window).width());jQuery(window).on("debouncedresize",function(){jQuery("#todays-paper-slider").width(jQuery(window).width()-112).css("margin-left",56);jQuery("#todays-paper-slider .flex-direction-nav").width(jQuery(window).width())});jQuery("#todays-paper .close").on("click",function(){jQuery("#todays-paper").animate({bottom:"-459px"},300,function(){jQuery("#todays-paper").hide()});jQuery("#todays-paper").removeClass("open")})}})}var CarouselLoader=function(b){var f={};var a={};function e(){b(window).on("scroll resize",d)}a.set=function(j,i,h){var g={context:j,"$elem":b("#"+j),publicationId:i,excludeStoryIds:JSON.stringify(h||[]),loaded:false};if(!g.$elem.length==1){throw"Could not resolve context element '#"+j+"' for loading carousel"}f[j]=g;d()};function d(){var h,g;for(h in f){g=f[h];if(g.loaded||g.$elem.getViewportDistance()>300){continue}c(g);f[h].loaded=true}}function c(g){jQuery.ajax({url:"/main/buildCarousel/",data:{publicationId:g.publicationId,storyIdsOnPage:g.excludeStoryIds},context:"#"+g.context}).always(function(k,j,h){var i=TJGateway.findRequest(arguments);if(!i.viewHandled){return}jQuery(".carousel-wrapper").flexslider({animation:"slide",animationLoop:false,itemWidth:236,itemMargin:5,slideshow:false});jQuery(".scale-image").css({position:"relative",overflow:"hidden",display:"block"});jQuery(".scale-image img").css({position:"absolute",display:"block",visibility:"visible"})})}b(document).ready(e);return a}(jQuery);function generateTabStories(b,a,c){jQuery.ajax({url:"/mainAjax/buildSubCategoryStories/",dataType:"html",type:"POST",data:{publicationId:b,categoryId:a,storyIdsOnPage:JSON.stringify(c)},success:function(f,e,d){e.viewHandled=true;if(f){jQuery("#"+a).html(f);scaleImage()}else{jQuery("#"+a).html(TJ.t("lbl_no_sub_category_stories"))}}})}jQuery(window).resize(function(){if(jQuery("#alertSubDialog").length>0){jQuery("#alertSubDialog").dialog("option","position","center")}});function modifyFrequency(a,b){window.currentAlertType=a;jQuery.ajax({url:"/mainAjax/modifyAlert",dataType:"json",type:"POST",data:{publicationId:window.currentActivePublication,alertType:a,unsubscribe:b},complete:function(c){window.alertSemaphore=false}})}function modifyAlert(c,a,b){window.currentActivePublication=c;jQuery.ajax({url:"/mainAjax/modifyAlert",dataType:"json",type:"POST",data:{publicationId:c,alertType:a,unsubscribe:b},complete:function(d){window.alertSemaphore=false}})}function handleAlertSubscription(b,a){if(a===true){jQuery.ajax({url:"/mainAjax/modifyAlertSubscriptionPublication",dataType:"json",type:"POST",data:{publicationId:b},complete:function(c){window.alertSemaphore=false}})}else{jQuery.ajax({url:"/mainAjax/modifyAlertsSubscriptionStatus",dataType:"json",type:"POST",complete:function(c){window.alertSemaphore=false}})}}function handleSubscriptionAlertType(a){jQuery.ajax({url:"/mainAjax/modifyAlertsSubscriptionType",dataType:"json",type:"POST",data:{alertTypeId:a},complete:function(b){window.alertSemaphore=false}})}function iframeLoaded(a){jQuery("#profile_pic_small").attr("src",a)}function isIE(d,f){var g="IE",c=document.createElement("B"),a=document.documentElement,e;if(d){g+=" "+d;if(f){g=f+" "+g}}c.innerHTML="<!--[if "+g+']><b id="iecctest"></b><![endif]-->';a.appendChild(c);e=!!document.getElementById("iecctest");a.removeChild(c);return e}if(isIE(8)){jQuery("html").addClass("browser-ie8")}function trackLogForMobileViewer(b,a,d,c){jQuery.ajax({type:"POST",url:"/archiveBrowse/trackMobileViewer/?pubDisplayName="+b+"&date="+a+"&page="+d+"&requestUrl="+c,dataType:"json",error:{},success:{}})}function trackLogForOliveViewer(a){jQuery.ajax({type:"POST",url:"/main/trackOliveViewer/?requestUrl="+encodeURIComponent(a),dataType:"json",error:{},success:{}})}function trackLogForObituaries(a){jQuery.ajax({type:"POST",url:"/main/trackObituaries/?requestUrl="+encodeURIComponent(a),dataType:"json",error:{},success:{}})};